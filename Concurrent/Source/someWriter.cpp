/*==============================================================================
Description:
==============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include <prnPrint.h>

#include "LFIntQueue.h"
#include "RisIntQueue.h"
#include "someShare.h"
#include "someWriter.h"

namespace Some
{

//******************************************************************************
//******************************************************************************
//******************************************************************************

Writer::Writer()
{
   initialize(0);
}

void Writer::initialize(unsigned aIdent)
{
   mIdent = aIdent;
   mCode = 0;

   mPassCount = 0;
   mFailCount = 0;
   mCodeSum   = 0;
}

void Writer::finalize()
{
}

//******************************************************************************
//******************************************************************************
//******************************************************************************

void Writer::show()
{
   Prn::print(0,"Writer.mIdent     %d",  mIdent);
   Prn::print(0,"Writer.mPassCount %llu",mPassCount);
   Prn::print(0,"Writer.mFailCount %llu",mFailCount);
   Prn::print(0,"Writer.mCodeSum   %llu",mCodeSum);
   Prn::print(0,"");
}
  
//******************************************************************************
//******************************************************************************
//******************************************************************************

void Writer::write1(int aNumWrites)
{
   for (int i = 0; i < aNumWrites; i++)
   {
      mCode++;
      IntMessage tMsg(mIdent,mCode);

      if (LFIntQueue::tryWrite(tMsg.aint()))
      {
         mPassCount++;
         mCodeSum += mCode;
      }
      else
      {
         mFailCount++;
      }
   }
}

//******************************************************************************
//******************************************************************************
//******************************************************************************

void Writer::write2(int aNumWrites)
{
   for (int i = 0; i < aNumWrites; i++)
   {
      mCode++;
      IntMessage tMsg(mIdent,mCode);

      if (RisIntQueue::tryWrite(tMsg.aint()))
      {
         mPassCount++;
         mCodeSum += mCode;
      }
      else
      {
         mFailCount++;
      }
   }
}

//******************************************************************************
//******************************************************************************
//******************************************************************************

void Writer::write(int aNumWrites)
{
   switch (gShare.mMode)
   {
   case 1: return write1(aNumWrites);
   case 2: return write2(aNumWrites);
   }
}
   


   
}//namespace